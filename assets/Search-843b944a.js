import{e as O,D as J,g as V,b as k,_ as K,m as W}from"./@varlet-7ae03b61.js";import{a as H,b as P}from"./index-87596f9d.js";import{q as C,h as v,z as p,M as g,Q as T,L as E,t as u,y as h,s as n,r as Q,l as U,w as X,I as b,J as l,u as x,F as z,N,R as Z,S as j,H as G,X as Y,Z as ee,A as q}from"./@vue-64dd07d0.js";import{u as I,o as te}from"./vue-router-bac0c6f6.js";import{d as se}from"./pinia-2579c363.js";import{P as M}from"./pubsub-js-d5437756.js";import{g as oe}from"./search-36dbb5c7.js";import"./decimal.js-d133ee8e.js";import"./dayjs-ee28432e.js";import"./@popperjs-974c24ae.js";import"./amfe-flexible-ec0a06bf.js";import"./highlight.js-9e946018.js";import"./vue-demi-71ba0ef2.js";import"./request-a0f91418.js";import"./axios-aba6f0e0.js";const ne={historySearch:[]},B=se("search",{state:()=>ne,actions:{setHistoryList(s){this.$reset(),s.forEach(t=>{this.historySearch.push(t)})},addHistory(s){this.historySearch.some((t,e,o)=>{if(t.name===s.name)return o.splice(e,1),!0}),this.historySearch.unshift(s),localStorage.setItem("history-list",JSON.stringify(this.historySearch))},resetHistory(){this.historySearch.splice(0,this.historySearch.length),localStorage.setItem("history-list",JSON.stringify([]))},deleteOneHistory(s){this.historySearch.some((t,e,o)=>{if(t.time===s)return o.splice(e,1),localStorage.setItem("history-list",JSON.stringify(o)),!0})}}}),re=C({__name:"SearchHistoryItem",props:{time:null,name:null},setup(s){const t=s,e=I(),o=B(),r=v(!1);function d(){const y=t.name;e.push({name:"search_result",query:{q:y}}),o.addHistory({name:y,time:+new Date})}async function _(){await J({message:`真的要删除历史记录:${t.name}吗`})==="confirm"&&o.deleteOneHistory(t.time)}M.subscribe("toShowDelete",()=>{r.value=!r.value});function S(){r.value?_():d()}return(y,D)=>{const w=O;return p(),g("li",{class:"history-search-item",onClick:S},[T(E(s.name)+" ",1),u(n(w,{color:"rgb(150,150,150)",name:"window-close",size:"10"},null,512),[[h,r.value]])])}}});const ae=H(re,[["__scopeId","data-v-0d4a3527"]]),ie=["innerHTML"],le=C({__name:"SearchWordsCell",props:{words:null,keywords:null},setup(s){const t=s,e=B(),o=I(),r=v(t.words);r.value=r.value.replaceAll(t.keywords,`<span style="color:red;">${t.keywords}</span>`);function d(){const _=t.words;o.push({name:"search_result",query:{q:_}}),e.addHistory({name:_,time:+new Date})}return(_,S)=>(p(),g("li",{onClick:d,innerHTML:r.value},null,8,ie))}});const ce=H(le,[["__scopeId","data-v-82f06461"]]),ue=(s,t)=>{let e=null;return()=>{e!==null&&clearTimeout(e),e=setTimeout(()=>{s()},t)}},he=s=>(Z("data-v-8cedd8fa"),s=s(),j(),s),de={id:"search-page"},_e=["onKeyup"],me={id:"search-box"},pe={id:"search-history"},ye={id:"search-title"},fe=he(()=>l("span",{style:{"font-size":"13px"}},"搜索历史",-1)),ve={id:"edit-history"},ge={id:"search-words-list"},Se=C({__name:"Search",setup(s){const t=B(),e=v(""),o=Q([]),r=v(!1),d=v(!1),_=I();U(()=>{const a=localStorage.getItem("history-list");if(!a)localStorage.setItem("history-list",JSON.stringify([]));else{const i=JSON.parse(a);t.setHistoryList(i)}});async function S(){var a;try{if(!e.value)return;const i=await oe({q:e.value});r.value=!1,(a=i.data)==null||a.options.forEach(f=>{f!==null&&o.push(f)})}catch{r.value=!1}}const y=ue(S,1e3);X(e,()=>{r.value=!0,o.splice(0,o.length),y()});async function D(){await J({title:"提示",message:"真的要删除所有历史记录吗?真的会消失很久很久哦!"})==="confirm"?(t.resetHistory(),k.success({content:"删除成功!",duration:2e3})):k.info({content:"取消了删除。",duration:1e3})}te(()=>{e.value=""});function w(){if(!e.value){k.warning("搜索内容不能为空!");return}const a=e.value;_.push({name:"search_result",query:{q:a}}),t.addHistory({name:a,time:+new Date})}function R(){d.value=!d.value,M.publish("toShowDelete")}return(a,i)=>{const f=O,L=K,A=V,$=P,m=W,F=G("getFoucs");return p(),g("div",de,[n(A,null,{left:b(()=>[n(L,{color:"transparent","text-color":"#fff",round:"",text:"",onClick:i[0]||(i[0]=c=>a.$router.back())},{default:b(()=>[n(f,{name:"chevron-left",size:24})]),_:1}),u(l("input",{placeholder:"请输入内容","onUpdate:modelValue":i[1]||(i[1]=c=>e.value=c),onKeyup:ee(w,["enter"])},null,40,_e),[[F],[Y,e.value]]),n(L,{size:"small",text:"",disabled:!e.value.length,onClick:w},{default:b(()=>[T("搜索")]),_:1},8,["disabled"])]),_:1}),l("div",me,[u(l("div",pe,[l("div",ye,[fe,l("div",ve,[l("span",{style:{"font-size":"13px","margin-right":"10px"},onClick:R},E(d.value?"完成":"编辑"),1),u(n(f,{size:"25",name:"trash-can-outline",onClick:D},null,512),[[h,x(t).historySearch.length]])])]),l("ul",null,[(p(!0),g(z,null,N(x(t).historySearch,c=>(p(),q(ae,{key:c.time,time:c.time,name:c.name},null,8,["time","name"]))),128)),u(n($,{style:{"flex-grow":"1"},title:"无历史记录",height:"300","icon-size":"100","icon-color":"skyblue"},null,512),[[h,!x(t).historySearch.length]])])],512),[[h,!e.value]]),u(l("ul",ge,[(p(!0),g(z,null,N(o,c=>(p(),q(ce,{words:c,keywords:e.value},null,8,["words","keywords"]))),256)),u(n(f,{color:"rgb(110,110,110)",id:"clear-words-button",onClick:i[2]||(i[2]=c=>e.value=""),name:"window-close"},null,512),[[h,o.length&&!r.value]]),u(n($,{title:"您搜的关键词好犀利啊，换个关键词吧~",height:"300","icon-size":"100","icon-color":"skyblue"},null,512),[[h,!o.length&&!r.value]]),u(l("li",null,[n(m),n(m),n(m),n(m),n(m),n(m),n(m)],512),[[h,r.value]])],512),[[h,e.value]])])])}}});const Je=H(Se,[["__scopeId","data-v-8cedd8fa"]]);export{Je as default};
