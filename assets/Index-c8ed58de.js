import{e as N,b as U,_ as j,f as H,g as M,A as J,h as Q,i as W,j as G,k as K,l as O,m as X,n as Z}from"./@varlet-7ae03b61.js";import{a as R,b as ee,c as ne,d as te}from"./index-87596f9d.js";import{q as D,h as w,z as u,M as L,J as i,L as F,t as T,y as B,s as a,e as ae,I as c,Q as z,F as I,N as S,A as k,u as E,r as oe,a8 as se,c as le,a as ie,w as ce,v as re,a9 as ue}from"./@vue-64dd07d0.js";import{P as V}from"./pubsub-js-d5437756.js";import{d as _e,s as P}from"./pinia-2579c363.js";import{r as $}from"./request-a0f91418.js";import{A as de}from"./ArticleCell-e10b2560.js";import{b as he,u as pe}from"./vue-router-bac0c6f6.js";import"./decimal.js-d133ee8e.js";import"./dayjs-ee28432e.js";import"./@popperjs-974c24ae.js";import"./amfe-flexible-ec0a06bf.js";import"./highlight.js-9e946018.js";import"./vue-demi-71ba0ef2.js";import"./axios-aba6f0e0.js";import"./timeFormat-5849a29c.js";const me=D({__name:"ChannelItem",props:{id:null,name:null,tags:{type:Boolean}},emits:["deleteChannel","toChannel","addChannel"],setup(o,{emit:n}){const t=o,l=w(!1);V.subscribe("toggleDelete",(_,C)=>{l.value=C});function f(){t.tags?l.value?n("deleteChannel",t.id):n("toChannel",t.id):n("addChannel",t.id)}return(_,C)=>{const r=N;return u(),L("li",{onClick:f},[i("span",null,F(o.name),1),T(a(r,{size:"10",name:"window-close",color:"rgb(170,170,170)",style:{position:"absolute",top:"0",right:"0"}},null,512),[[B,o.tags&&l.value]])])}}});const q=R(me,[["__scopeId","data-v-ae8921bb"]]),ve=()=>$.get("/v1_0/user/channels"),fe=(o,n)=>$.get("/v1_0/articles",{params:{channel_id:o,timestamp:n}}),Ce=()=>$.get("/v1_0/channels"),ge=o=>$.put("/v1_0/user/channels",o),be={channelList:[],allChannelList:[]},Y=_e("channel",{state(){return be},actions:{setChannelList(o,n){n.forEach(t=>{o.push(t)})},async getChannelFirst(){var o,n;try{const t=await ve();this.setChannelList(this.channelList,(o=t.data)==null?void 0:o.channels);const l=await Ce();this.setChannelList(this.allChannelList,(n=l.data)==null?void 0:n.channels)}catch{}},async toUpdateChannelList(){const o=this.channelList.map((n,t)=>({id:n.id,seq:t+""}));try{await ge({channels:o})}catch{}}}}),ye={id:"channel-edit"},we={id:"channel"},Le={id:"my-channel"},xe={class:"channel-title"},ke=i("div",null,[i("span",null,"我的频道"),i("span",null,"点击进入频道")],-1),Ae={class:"channel-list"},Ee={id:"more-channel"},Ie=i("div",{class:"channel-title"},"点击添加更多频道:",-1),Se={class:"channel-list"},Te=D({__name:"ChannelEdit",emits:["toCloseChannelEdit","changeActive"],setup(o,{emit:n}){const t=Y(),{channelList:l,allChannelList:f}=P(t),_=w(!1);function C(){n("toCloseChannelEdit")}function r(){_.value=!_.value,V.publish("toggleDelete",_.value)}const g=ae(()=>f.value.filter(d=>{for(let h=0;h<l.value.length;h++)if(l.value[h].id===d.id)return!1;return d}));function m(d){_.value&&r(),C(),n("changeActive",d)}function y(d){if(l.value.length===1){U.warning({content:"不能再移除了!"});return}if(!d){U.warning({content:"此项不能被删除!"});return}l.value.some((h,p,s)=>{h.id===d&&s.splice(p,1)}),t.toUpdateChannelList()}function A(d){f.value.some(h=>{h.id===d&&l.value.push(h)}),t.toUpdateChannelList(),r(),r()}return(d,h)=>{const p=N,s=j,b=H,v=M,e=ee;return u(),L("div",ye,[a(v,{title:"频道管理","title-position":"center"},{right:c(()=>[a(b,null,{default:c(()=>[a(s,{onClick:C,color:"transparent","text-color":"#fff",round:"",text:""},{default:c(()=>[a(p,{name:"window-close",size:24})]),_:1})]),_:1})]),_:1}),i("div",we,[i("div",Le,[i("div",xe,[ke,a(s,{text:"",onClick:r},{default:c(()=>[z(F(_.value?"完成":"编辑"),1)]),_:1})]),i("ul",Ae,[(u(!0),L(I,null,S(E(l),x=>(u(),k(q,{onToChannel:m,onDeleteChannel:y,tags:!0,id:x.id,key:x.id,name:x.name},null,8,["id","name"]))),128))])]),T(i("div",Ee,[Ie,i("ul",Se,[(u(!0),L(I,null,S(E(g),x=>(u(),k(q,{onAddChannel:A,tags:!1,id:x.id,key:x.id,name:x.name},null,8,["id","name"]))),128)),T(a(e,{style:{"flex-grow":"1"},title:"没有更多频道啦!"},null,512),[[B,!E(g).length]])])],512),[[B,_.value]])])])}}});const Be=D({__name:"ArticleList",props:{id:null},async setup(o){let n,t;const l=o,f=w(!0),_=oe([]),C=w(+new Date),r=w(!1),g=w(!1),{path:m}=he();[n,t]=se(()=>y()),await n,t();async function y(){var p,s,b;r.value=!0;try{const v=await fe(l.id,C.value);(p=v.data)!=null&&p.results.length||(g.value=!0),(s=v.data)==null||s.results.forEach(e=>{_.push(e)}),C.value=+((b=v.data)==null?void 0:b.pre_timestamp),r.value=!1}catch{r.value=!1,g.value=!0}}function A(){f.value&&y()}function d(p){m==="/home/index"&&h(p)}async function h(p){const s=await J({actions:[{name:"反馈为垃圾内容",icon:"phone-outline"},{name:"不感兴趣",icon:"trash-can-outline"},{name:"取消",icon:"window-close"}]});if(s.name==="反馈为垃圾内容"){U.success({content:"已反馈!我们会减少此类推送",duration:3e3});return}else if(s.name==="取消")return;_.some((b,v,e)=>{if(b.art_id===p)return e.splice(v,1),!0})}return le(()=>{f.value=!1}),ie(()=>{f.value=!0,r.value=!1}),(p,s)=>{const b=Q,v=W;return u(),k(v,{finished:g.value,loading:r.value,"onUpdate:loading":s[0]||(s[0]=e=>r.value=e),onLoad:A},{default:c(()=>[(u(!0),L(I,null,S(_,e=>(u(),k(b,{key:e},{default:c(()=>[a(de,{onToDeleteArticle:d,is_top:e.is_top,pubdate:e.pubdate,cover:e.cover,comm_count:e.comm_count,aut_id:e.aut_id,title:e.title,art_id:e.art_id,aut_name:e.aut_name},null,8,["is_top","pubdate","cover","comm_count","aut_id","title","art_id","aut_name"])]),_:2},1024))),128))]),_:1},8,["finished","loading"])}}}),De=()=>{const o=Y(),{channelList:n,allChannelList:t}=P(o);return o.getChannelFirst(),{channelList:n,allChannelList:t}},$e={id:"index",class:"in-page"},Ue={id:"channel-tabs-box"},ze={id:"channel-tabs"},Ne={id:"index-main"},Fe=D({__name:"Index",setup(o){const n=w(0),{channelList:t}=De(),l=w(!1);ce(n,()=>{window.scroll(0,0)});const f=pe();function _(){ne(f)&&(l.value=!0,document.body.style.overflowY="hidden")}function C(){l.value=!1,document.body.style.overflowY="auto"}function r(g){t.value.some((m,y)=>{if(m.id===g)return n.value=y,!0})}return(g,m)=>{const y=te,A=N,d=K,h=O,p=M,s=X,b=Z,v=G;return u(),L("div",$e,[a(p,{style:{position:"sticky",top:"0","z-index":"100"}},{default:c(()=>[z("蓝客资讯")]),right:c(()=>[a(y),i("div",{class:"top-bar-right",onClick:m[0]||(m[0]=e=>g.$router.push({name:"search"}))},[a(A,{name:"magnify",size:"24"})])]),content:c(()=>[i("div",Ue,[i("div",ze,[a(h,{color:"#fff","active-color":"#3a7afe","inactive-color":"black",active:n.value,"onUpdate:active":m[1]||(m[1]=e=>n.value=e)},{default:c(()=>[(u(!0),L(I,null,S(E(t),e=>(u(),k(d,{key:e.id},{default:c(()=>[z(F(e.name),1)]),_:2},1024))),128))]),_:1},8,["active"])]),i("div",{id:"update-channel-button",onClick:_},"+")])]),_:1}),i("div",Ne,[a(v,{active:n.value,"onUpdate:active":m[2]||(m[2]=e=>n.value=e)},{default:c(()=>[(u(!0),L(I,null,S(E(t),e=>(u(),k(b,{key:e.id},{default:c(()=>[(u(),k(ue,null,{fallback:c(()=>[i("div",null,[a(s,{title:""}),a(s,{title:""}),a(s,{title:""}),a(s,{title:""}),a(s,{title:""}),a(s,{title:""})])]),default:c(()=>[a(Be,{id:e.id},null,8,["id"])]),_:2},1024))]),_:2},1024))),128))]),_:1},8,["active"])]),a(re,{name:"channel"},{default:c(()=>[T(a(Te,{onChangeActive:r,onToCloseChannelEdit:C},null,512),[[B,l.value]])]),_:1})])}}});const en=R(Fe,[["__scopeId","data-v-cfa39777"]]);export{en as default};
