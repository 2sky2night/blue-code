import{o as W,e as E,b as D,_ as Y,g as Z,m as tt,i as et,p as ot,q as nt,h as it}from"./@varlet-7ae03b61.js";import{h as m,r as N,l as lt,q as U,z as w,M as $,J as s,s as r,L as f,u as o,o as st,w as at,I as p,t as k,y as T,i as M,X as ct,H as ut,Q as V,F as rt,N as _t,A as mt,n as dt}from"./@vue-64dd07d0.js";import{g as pt,t as ft,a as vt,b as gt,c as ht,d as Ct,s as kt,e as yt,f as xt,U as bt}from"./UserCell-5eba393e.js";import{c as L,a as q}from"./index-87596f9d.js";import{u as A,b as wt}from"./vue-router-bac0c6f6.js";import{t as Lt}from"./timeFormat-5849a29c.js";import"./decimal.js-d133ee8e.js";import"./dayjs-ee28432e.js";import"./@popperjs-974c24ae.js";import"./request-a0f91418.js";import"./axios-aba6f0e0.js";import"./pinia-2579c363.js";import"./vue-demi-71ba0ef2.js";import"./amfe-flexible-ec0a06bf.js";import"./highlight.js-9e946018.js";const At=c=>{const u=m(!0),e=N({art_id:"",attitude:0,aut_id:"",aut_name:"",aut_photo:"",comm_count:0,content:"",is_collected:!1,is_followed:!1,pubdate:"",title:"",read_count:0,like_count:0}),a=A();async function d(){if(L(a))try{e.attitude?(await ft(c),e.attitude=0):(await vt(c),e.attitude=1)}catch{a.push("/login")}}async function l(){if(L(a))try{e.is_collected?(await gt(c),e.is_collected=!1):(await ht({target:c}),e.is_collected=!0)}catch{a.push("/login")}}return lt(async()=>{try{const{data:t}=await pt(c);e.art_id=t==null?void 0:t.art_id,e.attitude=t==null?void 0:t.attitude,e.aut_id=t==null?void 0:t.aut_id,e.aut_name=t==null?void 0:t.aut_name,e.aut_photo=t==null?void 0:t.aut_photo,e.comm_count=t==null?void 0:t.comm_count,e.content=t==null?void 0:t.content,e.is_collected=t==null?void 0:t.is_collected,e.like_count=t==null?void 0:t.like_count,e.pubdate=t==null?void 0:t.pubdate,e.read_count=t==null?void 0:t.read_count,e.title=t==null?void 0:t.title,document.title=e.title,u.value=!1,e.attitude===-1&&(e.attitude=0)}catch{a.push("/login")}}),{articleDetail:e,loadingPage:u,toggleLikeArticle:d,toggleStarArticle:l}},It=c=>{const u=m(!1),e=m(""),a=N([]),d=m(""),l=m(0),t=m(!1),v=m(!1),g=A();function h(){u.value=!1}function I(){L(g)&&(u.value=!0)}async function y(){try{t.value=!0;const{data:n}=await Ct({type:"a",source:c,offset:d.value,limit:"10"});l.value=n==null?void 0:n.total_count,(n==null?void 0:n.end_id)===(n==null?void 0:n.last_id)&&(v.value=!0,t.value=!1),d.value=n==null?void 0:n.last_id,n==null||n.results.forEach(x=>{a.push(x)})}catch{v.value=!0,t.value=!1}}async function C(){try{const{data:n}=await kt({art_id:c,content:e.value,target:c});a.unshift(n==null?void 0:n.new_obj),l.value++}catch{g.push("/login")}finally{e.value="",u.value=!1}}return y(),{commentCount:l,showInput:u,commentContent:e,hideCommentTextare:h,commentList:a,getArticleComment:y,loading:t,finished:v,toSendComment:C,openCommentInput:I}},zt={class:"comment-cell"},Bt={class:"comment-title"},St={style:{"margin-left":"10px"}},Tt={class:"comment-content"},$t={class:"comment-time"},Dt=U({__name:"CommentCell",props:{aut_id:null,aut_name:null,aut_photo:null,com_id:null,content:null,is_liking:{type:Boolean},like_count:null,pubdate:null,reply_count:null},setup(c){const u=c,e=m(u.is_liking),a=m(u.like_count),d=A();async function l(){L(d)&&(e.value?(await yt(u.com_id),e.value=!1,a.value--):(await xt({target:u.com_id}),e.value=!0,a.value++))}return(t,v)=>{const g=W,h=E;return w(),$("div",zt,[s("div",Bt,[s("div",null,[r(g,{width:"40",height:"40",src:c.aut_photo,style:{"border-radius":"50%"}},null,8,["src"]),s("span",St,f(c.aut_name),1)]),r(h,{size:"30",onClick:l,color:e.value?"red":"",name:e.value?"heart":"heart-outline"},null,8,["color","name"])]),s("div",Tt,f(c.content),1),s("div",$t,[s("span",null,"liked:"+f(a.value),1),s("span",null,f(o(Lt)(c.pubdate)),1)])])}}});const Mt=q(Dt,[["__scopeId","data-v-6d917af0"]]),Vt={style:{"margin-top":"5px","font-size":"12px",color:"rgb(150,150,150)"}},Et=["innerHTML"],Nt={id:"comment"},Ut={id:"article-bottom"},qt={style:{position:"relative"}},Ft={class:"icon-box"},Ht={id:"comment-input"},Rt=U({__name:"Article",setup(c){const{query:u}=wt(),e=A();u.id||D.error({content:"参数错误，不能加载此页面!",duration:2e3,onClose:()=>{e.push("/home/index")}});let a=null;const d=m(null),{articleDetail:l,loadingPage:t,toggleLikeArticle:v,toggleStarArticle:g}=At(u.id),{openCommentInput:h,toSendComment:I,commentCount:y,showInput:C,commentContent:n,hideCommentTextare:x,commentList:F,getArticleComment:H,finished:R,loading:z}=It(u.id);st(()=>{a=document.getElementById("comment")});function P(){a==null||a.scrollIntoView({behavior:"smooth"})}return at(C,B=>{B&&dt(()=>d.value.focus())}),(B,_)=>{const b=E,S=Y,j=Z,J=tt,Q=nt,X=it,G=et,K=ot,O=ut("highlight");return w(),$("div",null,[r(j,{title:"文章详情","title-position":"center",style:{"z-index":"100",position:"sticky",top:"0"}},{left:p(()=>[r(S,{color:"transparent","text-color":"#fff",round:"",text:"",onClick:_[0]||(_[0]=i=>B.$router.back())},{default:p(()=>[r(b,{name:"chevron-left",size:24})]),_:1})]),_:1}),r(J,{title:"",rows:"30",loading:o(t)},null,8,["loading"]),k(s("div",null,[s("div",{id:"article-main",onClick:_[2]||(_[2]=(...i)=>o(x)&&o(x)(...i))},[s("h1",null,f(o(l).title),1),r(bt,{user_photo:o(l).aut_photo,is_followed:o(l).is_followed,user_id:o(l).aut_id,user_name:o(l).aut_name},{time:p(()=>[s("div",Vt,f(o(l).pubdate),1)]),_:1},8,["user_photo","is_followed","user_id","user_name"]),k(s("div",{id:"article-content",innerHTML:o(l).content},null,8,Et),[[O]]),r(Q,{description:"End"}),r(S,{onClick:o(v),text:o(l).attitude!==1,size:"small",type:"danger",outline:""},{default:p(()=>[V(f(o(l).attitude===1?"已点赞":"点赞"),1)]),_:1},8,["onClick","text"]),s("div",Nt,[r(G,{finished:o(R),loading:o(z),"onUpdate:loading":_[1]||(_[1]=i=>M(z)?z.value=i:null),onLoad:o(H)},{default:p(()=>[(w(!0),$(rt,null,_t(o(F),i=>(w(),mt(X,{key:i.aut_id},{default:p(()=>[r(Mt,{aut_id:i.aut_id,aut_name:i.aut_name,aut_photo:i.aut_photo,com_id:i.com_id,content:i.content,is_liking:i.is_liking,like_count:i.like_count,pubdate:i.pubdate,reply_count:i.reply_count},null,8,["aut_id","aut_name","aut_photo","com_id","content","is_liking","like_count","pubdate","reply_count"])]),_:2},1024))),128))]),_:1},8,["finished","loading","onLoad"])])]),s("div",Ut,[k(s("div",qt,[s("div",{onClick:_[3]||(_[3]=(...i)=>o(h)&&o(h)(...i)),id:"to-send-comment"},"发送评论"),s("div",Ft,[r(K,{type:"danger",value:o(y),style:{position:"absolute",top:"-3vh",left:"8vw","z-index":"100"}},null,8,["value"]),r(b,{onClick:P,size:"25",name:"message-text-outline"}),r(b,{onClick:o(g),size:"25",name:o(l).is_collected?"star":"star-outline",color:o(l).is_collected?"yellow":""},null,8,["onClick","name","color"]),r(b,{onClick:_[4]||(_[4]=i=>o(D).info("暂未开放")),size:"25",name:"upload"})])],512),[[T,!o(C)]]),k(s("div",Ht,[k(s("textarea",{ref_key:"commentText",ref:d,id:"comment-text",placeholder:"友善评论、理性发言、阳光心灵","onUpdate:modelValue":_[5]||(_[5]=i=>M(n)?n.value=i:null)},null,512),[[ct,o(n)]]),r(S,{onClick:o(I),text:"",style:{height:"100%"},disabled:!o(n)},{default:p(()=>[V("发布")]),_:1},8,["onClick","disabled"])],512),[[T,o(C)]])])],512),[[T,!o(t)]])])}}});const ie=q(Rt,[["__scopeId","data-v-2a3032d2"]]);export{ie as default};
