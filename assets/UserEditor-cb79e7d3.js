import{P as E,A as M,g as O,h as N,u as R,e as Y,_ as j,o as z,t as G}from"./@varlet-7ae03b61.js";import{r as L,h as g,q,e as J,M as H,J as a,s as i,I as m,u as r,F as K,z as Q,L as k,t as $,ab as S,R as T,S as W}from"./@vue-64dd07d0.js";import{_ as X}from"./BigPhoto.vue_vue_type_script_setup_true_lang-832fbd30.js";import{c as Z,u as tt,d as D}from"./user-cfbfdba8.js";import{P as et}from"./pubsub-js-d5437756.js";import{u as ot}from"./vue-router-bac0c6f6.js";import{a as nt}from"./index-87596f9d.js";import"./decimal.js-d133ee8e.js";import"./dayjs-ee28432e.js";import"./@popperjs-974c24ae.js";import"./request-a0f91418.js";import"./axios-aba6f0e0.js";import"./highlight.js-9e946018.js";import"./pinia-2579c363.js";import"./vue-demi-71ba0ef2.js";import"./amfe-flexible-ec0a06bf.js";const _=t=>Array.from({length:t},(e,u)=>u+1),rt=_(12),st=_(29),at=_(28),it=_(31),lt=_(30),ut=dt(1970,new Date().getFullYear()+1);function pt(t){return[1,3,5,7,8,10,12].includes(t)}function B(t){return t%4===0&&t%100!==0||t%400===0}function ct(t,e){return B(t)&&e===2?st:!B(t)&&e===2?at:pt(e)?it:lt}function dt(t,e){const u=[];for(let l=t;l<e;l++)u.push({text:l,children:rt.map(h=>({text:h,children:ct(l,h).map(v=>({text:v}))}))});return u}function mt(t,e){if(e===0)return`${t}年`;if(e===1)return`${t}月`;if(e===2)return`${t}日`}async function ft(){const{state:t,texts:e}=await E({cascade:!0,columns:ut,textFormatter:mt});return{state:t,texts:e}}const ht=()=>{const t=L({birthday:"2002-06-03",id:"001",name:"用户名",mobile:"13983999999",gender:0,photo:"https://varlet.gitee.io/varlet-ui/cat.jpg"}),e=g(""),u=g(0),l=ot();async function h(){try{const{data:n}=await Z();t.birthday=n==null?void 0:n.birthday,t.gender=n==null?void 0:n.gender,t.id=n==null?void 0:n.id,t.mobile=n==null?void 0:n.mobile,t.name=n==null?void 0:n.name,t.photo=n==null?void 0:n.photo,u.value=t.gender,e.value=t.name}catch{l.push("/login")}}async function v(n){(await M({actions:[{name:"查看高清头像",icon:"account-circle"},{name:"更新头像",icon:"upload"}]})).name==="查看高清头像"?et.publish("onOpen"):n.click()}async function y(n){try{const p=n.target.files[0];if(p){const c=new FormData;c.append("photo",p);const{data:d}=await tt(c);t.photo=d==null?void 0:d.photo}}catch{l.push("/login")}}async function x(){try{await D({name:t.name}),e.value=t.name}catch{l.push("/login")}}async function b(){try{await D({gender:t.gender}),u.value=t.gender}catch{l.push("/login")}}async function U(){try{const{state:n,texts:p}=await ft();if(n==="confirm"){const c=p.map(d=>d<10?"0"+d:d).join("-");await D({birthday:c}),t.birthday=c}}catch{l.push("/login")}}return h(),{userData:t,handleClickPhoto:v,toUpdateUserPhoto:y,updateUsername:x,usernamePre:e,sexPre:u,updateSex:b,changeBirthday:U}},C=t=>(T("data-v-9a7fcbb0"),t=t(),W(),t),vt={class:"user-edit-cell"},gt={class:"user-edit-cell"},_t={class:"user-edit-cell"},yt={class:"user-edit-cell"},bt=C(()=>a("span",null,"修改用户名称",-1)),wt=C(()=>a("span",null,"修改用户性别",-1)),Ct={class:"sex-radio-box"},xt={class:"radio-item"},Ut=C(()=>a("label",{for:"man"},"男",-1)),kt={class:"radio-item"},Dt=C(()=>a("label",{for:"woman"},"女",-1)),Pt=q({__name:"UserEditor",setup(t){const{userData:e,handleClickPhoto:u,toUpdateUserPhoto:l,updateUsername:h,usernamePre:v,sexPre:y,updateSex:x,changeBirthday:b}=ht(),U=J(()=>e.gender?"女":"男"),n=g(null),p=g(!1),c=g(!1);return(d,o)=>{const f=Y,I=j,V=O,F=z,w=N,A=G,P=R;return Q(),H(K,null,[a("div",null,[i(V,{title:"编辑资料","title-position":"center"},{left:m(()=>[i(I,{onClick:o[0]||(o[0]=s=>d.$router.back()),color:"transparent","text-color":"#fff",round:"",text:""},{default:m(()=>[i(f,{name:"chevron-left",size:24})]),_:1})]),_:1}),a("div",null,[i(w,{title:"头像"},{extra:m(()=>[a("div",vt,[i(F,{onClick:o[1]||(o[1]=s=>r(u)(n.value)),radius:"50",width:"50",height:"50",src:r(e).photo},null,8,["src"]),i(f,{name:"chevron-right",color:"rgb(200,200,200)"}),a("input",{type:"file",ref_key:"photo",ref:n,style:{display:"none"},onChange:o[2]||(o[2]=(...s)=>r(l)&&r(l)(...s))},null,544)])]),_:1}),i(w,{title:"名称"},{extra:m(()=>[a("div",gt,[a("div",{onClick:o[3]||(o[3]=s=>p.value=!0),style:{width:"100px","text-align":"right"}},k(r(e).name),1),i(f,{name:"chevron-right",color:"rgb(200,200,200)"})])]),_:1}),i(w,{title:"性别"},{extra:m(()=>[a("div",_t,[a("div",{onClick:o[4]||(o[4]=s=>c.value=!0)},k(r(U)),1),i(f,{name:"chevron-right",color:"rgb(200,200,200)"})])]),_:1}),i(w,{title:"生日"},{extra:m(()=>[a("div",yt,[a("div",{style:{width:"90px"},onClick:o[5]||(o[5]=(...s)=>r(b)&&r(b)(...s))},k(r(e).birthday),1),i(f,{name:"chevron-right",color:"rgb(200,200,200)"})])]),_:1})])]),i(P,{show:p.value,"onUpdate:show":o[7]||(o[7]=s=>p.value=s),width:"90vw",onClickOverlay:o[8]||(o[8]=s=>r(e).name=r(v)),onCancel:o[9]||(o[9]=s=>r(e).name=r(v)),onConfirm:r(h)},{title:m(()=>[i(f,{name:"information",color:"#2979ff",style:{"margin-right":"10px"}}),bt,i(A,{modelValue:r(e).name,"onUpdate:modelValue":o[6]||(o[6]=s=>r(e).name=s)},null,8,["modelValue"])]),_:1},8,["show","onConfirm"]),i(P,{show:c.value,"onUpdate:show":o[12]||(o[12]=s=>c.value=s),width:"90vw",onClickOverlay:o[13]||(o[13]=s=>r(e).gender=r(y)),onCancel:o[14]||(o[14]=s=>r(e).gender=r(y)),onConfirm:r(x)},{title:m(()=>[i(f,{name:"information",color:"#2979ff",style:{"margin-right":"10px"}}),wt]),default:m(()=>[a("div",Ct,[a("div",xt,[Ut,$(a("input",{type:"radio",name:"sex",id:"man","onUpdate:modelValue":o[10]||(o[10]=s=>r(e).gender=s),value:0},null,512),[[S,r(e).gender]])]),a("div",kt,[Dt,$(a("input",{type:"radio",name:"sex",id:"woman","onUpdate:modelValue":o[11]||(o[11]=s=>r(e).gender=s),value:1},null,512),[[S,r(e).gender]])])])]),_:1},8,["show","onConfirm"]),i(X,{images:[r(e).photo]},null,8,["images"])],64)}}});const Lt=nt(Pt,[["__scopeId","data-v-9a7fcbb0"]]);export{Lt as default};
